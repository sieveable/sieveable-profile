language: go
go:
  - 1.6
services:
  - mysql
env:
    global:
      - USER=travis
      - DB=test_apps
before_install:
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover
before_script:
  - cat db_commands.sql | mysql -u travis
script:
  - "echo 'mode: atomic' > coverage.cov && go list ./... | xargs -n1 -I{} sh -c 'go test -covermode=atomic -coverprofile=coverage.tmp {} && tail -n +2 coverage.tmp >> coverage.cov' && rm coverage.tmp"
after_success:
  - $HOME/gopath/bin/goveralls -coverprofile=coverage.cov -service=travis-ci
